## 部署环境:  
_centos:_ 7.2双网卡  
_docker版本：_ 1.12.3    
_ansible:_ 2.1.2.0   
_主机名：_ localhost

### 有些代码执行结果没有黏贴出来,都能容易的判断出错误

* 关闭防火墙：（测试环境之下为了减少错误，直接关闭防火墙，在服务器上开启相应的服务端口）   
``systemctl stop firewalld && systemctl disable firewalld``

* 编辑主机名:  
``` 
vim /etc/hosts  
192.168.101.12 localhost  
```

* 安装相关的依赖包：<br>
``` 
yum install -y epel-release 
yum install -y python-pip 
pip install --upgrade pip 
yum install -y python-devel libffi-devel openssl-devel gcc vim git python-setuptools wget 

```

* 安装ansible并查看版本号： <br>
```  
pip install -U ansible     
ansible --version   
```   

* 安装docker并查看版本号： <br>
```   
curl -sSL https://get.docker.io | bash    
docker --version    
```   
* 配置docker文件，启动MountFlags选项，默认未开启，未配置会在deploy时 neutron-dhcp-agent容器抛出APIError/HTTPError:  
```   
mkdir -p /etc/systemd/system/docker.service.d
tee /etc/systemd/system/docker.service.d/kolla.conf <<-'EOF'
[Service]
MountFlags=shared
EOF
```   

* 加载配置文件设置自启，并启动docker服务： <br>
`` systemctl daemon-reload && systemctl enable docker && systemctl start docker `` 

* 下载kolla代码：<br>
``git clone https://git.openstack.org/openstack/kolla ``  

* 安装kolla: <br>
``pip install kolla/``

###执行结果复制： <br>
```   
[root@localhost ~]# pip install kolla/
Processing ./kolla
Collecting pbr>=1.6 (from kolla==3.0.0.0rc3.dev233)
  Using cached pbr-1.10.0-py2.py3-none-any.whl
Collecting docker-py<1.8.0,>=1.6.0 (from kolla==3.0.0.0rc3.dev233)
  Downloading docker-py-1.7.2.tar.gz (68kB)
    45% |██████████████▍                 | 30kB 4.7kB/s eta 0:00:08
    ........省略
Collecting pytz>=0a (from Babel>=2.3.4->oslo.i18n>=2.1.0->oslo.config>=3.14.0->kolla==3.0.0.0rc3.dev233)
  Downloading pytz-2016.7-py2.py3-none-any.whl (480kB)
    100% |████████████████████████████████| 481kB 99kB/s 
Installing collected packages: pbr, requests, websocket-client, docker-py, smmap, gitdb, smmap2, gitdb2, GitPython, rfc3986, pytz, Babel, oslo.i18n, netaddr, stevedore, wrapt, funcsigs, debtcollector, oslo.config, kolla
  Running setup.py install for websocket-client ... done
  Running setup.py install for docker-py ... done
  Running setup.py install for smmap ... done
  Running setup.py install for gitdb ... done
  Running setup.py install for wrapt ... done
  Running setup.py install for kolla ... done
Successfully installed Babel-2.3.4 GitPython-2.1.0 debtcollector-1.9.0 docker-py-1.7.2 funcsigs-1.0.2 gitdb-0.6.4 gitdb2-2.0.0 kolla-3.0.0.0rc3.dev233 netaddr-0.7.18 oslo.config-3.18.0 oslo.i18n-3.10.0 pbr-1.10.0 pytz-2016.7 requests-2.11.1 rfc3986-0.4.1 smmap-0.9.0 smmap2-2.0.1 stevedore-1.18.0 websocket-client-0.37.0 wrapt-1.10.8      
```  

*进入kolla目录，安装相关软件：<br>
```   
cd kolla/
pip install -U tox
pip install -U python-openstackclient python-neutronclient
```   

* 生成kolla-build.conf配置文件：<br>
``pip install -r requirements.txt -r test-requirements.txt``

###执行结果复制：<br>
```   
[root@localhost kolla]# pip install -r requirements.txt -r test-requirements.txt
Requirement already satisfied (use --upgrade to upgrade): pbr>=1.6 in /usr/lib/python2.7/site-packages (from -r requirements.txt (line 4))
Requirement already satisfied (use --upgrade to upgrade): docker-py<1.8.0,>=1.6.0 in /usr/lib/python2.7/site-packages (from -r requirements.txt (line 5))
Requirement already satisfied (use --upgrade to upgrade): Jinja2>=2.8 in /usr/lib64/python2.7/site-packages (from -r requirements.txt (line 6))
Requirement already satisfied (use --upgrade to upgrade): gitdb>=0.6.4 in /usr/lib64/python2.7/site-packages (from -r requirements.txt (line 7))
Requirement already satisfied (use --upgrade to upgrade): GitPython>=1.0.1 in /usr/lib/python2.7/site-packages (from -r requirements.txt (line 8))
Requirement already satisfied (use --upgrade to upgrade): six>=1.9.0 in /usr/lib/python2.7/site-packages (from -r requirements.txt (line 9))
Requirement already satisfied (use --upgrade to upgrade): oslo.config>=3.14.0 in /usr/lib/python2.7/site-packages (from -r requirements.txt (line 10))
Requirement already satisfied (use --upgrade to upgrade): setuptools!=24.0.0,>=16.0 in /usr/lib/python2.7/site-packages (from -r requirements.txt (line 11))
Requirement already satisfied (use --upgrade to upgrade): pycrypto>=2.6 in /usr/lib64/python2.7/site-packages (from -r requirements.txt (line 12))
Requirement already satisfied (use --upgrade to upgrade): netaddr!=0.7.16,>=0.7.13 in /usr/lib/python2.7/site-packages (from -r requirements.txt (line 13))
Collecting bandit>=1.1.0 (from -r test-requirements.txt (line 4))
  Downloading bandit-1.1.0-py2.py3-none-any.whl (114kB)
    100% |████████████████████████████████| 122kB 348kB/s 
Collecting bashate>=0.2 (from -r test-requirements.txt (line 5))
  Downloading bashate-0.5.1-py2-none-any.whl
Collecting beautifulsoup4 (from -r test-requirements.txt (line 6))
....省略
Requirement already satisfied (use --upgrade to upgrade): jsonpointer>=1.9 in /usr/lib/python2.7/site-packages (from jsonpatch<2,>=0.10->warlock!=1.3.0,<2,>=1.0.1->python-glanceclient>=2.5.0->python-openstackclient>=3.3.0->-r test-requirements.txt (line 21))
Installing collected packages: bandit, bashate, beautifulsoup4, docutils, restructuredtext-lint, chardet, doc8, extras, graphviz, mccabe, pep8, pyflakes, flake8, hacking, oslo.context, pyinotify, python-dateutil, oslo.log, mock, python-mimeparse, linecache2, traceback2, argparse, unittest2, fixtures, testtools, python-subunit, mox3, testrepository, oslotest, oslosphinx, reno, python-barbicanclient, python-ceilometerclient, futures, python-swiftclient, python-heatclient, snowballstemmer, alabaster, sphinx-rtd-theme, Pygments, sphinx, testscenarios
  Running setup.py install for docutils ... done
  Running setup.py install for restructuredtext-lint ... done
  Running setup.py install for chardet ... done
  Running setup.py install for mccabe ... done
  Running setup.py install for pyinotify ... done
  Running setup.py install for testrepository ... done
Successfully installed Pygments-2.1.3 alabaster-0.7.9 argparse-1.4.0 bandit-1.1.0 bashate-0.5.1 beautifulsoup4-4.5.1 chardet-2.3.0 doc8-0.7.0 docutils-0.12 extras-1.0.0 fixtures-3.0.0 flake8-2.5.5 futures-3.0.5 graphviz-0.5.1 hacking-0.11.0 linecache2-1.0.0 mccabe-0.2.1 mock-2.0.0 mox3-0.18.0 oslo.context-2.10.0 oslo.log-3.17.0 oslosphinx-4.8.0 oslotest-2.11.0 pep8-1.5.7 pyflakes-0.8.1 pyinotify-0.9.6 python-barbicanclient-4.1.0 python-ceilometerclient-2.6.1 python-dateutil-2.5.3 python-heatclient-1.5.0 python-mimeparse-1.6.0 python-subunit-1.2.0 python-swiftclient-3.1.0 reno-1.8.0 restructuredtext-lint-0.17.2 snowballstemmer-1.2.1 sphinx-1.3.6 sphinx-rtd-theme-0.1.9 testrepository-0.0.20 testscenarios-0.5.0 testtools-2.2.0 traceback2-1.4.0 unittest2-1.1.0
```

* 复制配置文件到/etc目录下: <br>
``cp -rv etc/kolla /etc/``

* build镜像，这步非常重要，跟网络有很大的关系： <br>
``kolla-build --base centos --type source -p default``




